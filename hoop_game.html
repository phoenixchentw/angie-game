<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å°ä¼éµæŠ•ç±ƒå¤§è³½</title>
    <style>
        :root { 
            --bg: #F5F5F5; 
            --text: #546E7A; 
            --ball: #FFAB91;
            --hoop: #90A4AE;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; overflow: hidden; background: var(--bg); font-family: sans-serif; width: 100%; height: 100%; position: fixed; }
        #game-wrapper { position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; overflow: hidden; }
        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; }

        .home-btn {
            position: absolute; top: 15px; right: 15px; width: 44px; height: 44px;
            background: rgba(255, 255, 255, 0.4); border: 2px solid #fff; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            color: var(--text); font-size: 24px; text-decoration: none;
            z-index: 10000; backdrop-filter: blur(5px);
        }

        #hud { position: absolute; top: 20px; left: 20px; color: var(--text); z-index: 5000; pointer-events: none; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.9); display: flex; justify-content: center; align-items: center; z-index: 8000; flex-direction: column; }
        .btn-real { background: #81C784; color: white; border: 3px solid white; padding: 18px 50px; font-size: 24px; border-radius: 60px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 0 #66BB6A; }
    </style>
</head>
<body>

<div id="game-wrapper">
    <a href="index.html" class="home-btn">ğŸ </a>
    <div id="hud">
        <div style="font-size: 20px; font-weight: bold;">æŠ•ç±ƒç¸½åˆ†: <span id="score-text">0</span> / 100</div>
    </div>
    
    <canvas id="gameCanvas"></canvas>

    <div id="start-mask" class="overlay">
        <h1 style="color:var(--text); margin-bottom:10px;">ğŸ€ å°ä¼éµæŠ•ç±ƒ</h1>
        <p style="color:#78909C; margin-bottom:30px; text-align:center; padding: 0 20px;">
            æŒ‰ä½çƒå‘ã€Œä¸‹æ–¹ã€æ‹‰å†æ”¾é–‹ï¼<br>
            åƒæ‹‰å½ˆå¼“ä¸€æ¨£æŠ•ç±ƒã€‚
        </p>
        <button class="btn-real" id="start-btn">é–‹å§‹æ¯”è³½ï¼</button>
    </div>

    <div id="result-modal" class="overlay" style="display:none;">
        <div style="background: white; padding: 30px; border-radius: 25px; text-align: center; width: 85%; max-width: 320px;">
            <h2 style="color:var(--text);">ç¥å°„æ‰‹é€šé—œï¼</h2>
            <p id="final-score" style="color:#FF8A80; font-size:28px; font-weight:bold; margin:15px 0;"></p>
            <button class="btn-real" style="font-size:18px; padding:12px 30px;" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
            <a href="index.html" style="text-decoration:none; color:#90A4AE; font-weight:bold; display:block; margin-top:20px;">å›åˆ°å¤§å»³</a>
        </div>
    </div>
</div>

<script>
var canvas = document.getElementById('gameCanvas');
var ctx = canvas.getContext('2d');
var score = 0;
var isGaming = false;

// ç‰©ç†èˆ‡ä½ç½® (ç›´å±å„ªåŒ–)
var gravity = 0.28;
var ball = { x: 0, y: 0, radius: 22, vx: 0, vy: 0, isFlying: false };
var hoop = { x: 0, y: 0, width: 90, height: 10 };
var targetX, targetY; // åˆå§‹ä½ç½®

// æ“æ§
var isDragging = false;
var dragStart = { x: 0, y: 0 };
var dragCurrent = { x: 0, y: 0 };
var floatingTexts = [];

function init() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    // ç›´å±ä½ç½®ï¼šçƒåœ¨ä¸‹æ–¹ 80%ï¼Œç±ƒæ¡†åœ¨ä¸Šæ–¹ 25%
    targetX = canvas.width / 2;
    targetY = canvas.height * 0.8;
    
    hoop.x = (canvas.width / 2) - (hoop.width / 2);
    hoop.y = canvas.height * 0.25;

    resetBall();
}

function resetBall() {
    ball.x = targetX;
    ball.y = targetY;
    ball.vx = 0;
    ball.vy = 0;
    ball.isFlying = false;
}

function update() {
    if (!isGaming) return;

    if (ball.isFlying) {
        ball.vy += gravity;
        ball.x += ball.vx;
        ball.y += ball.vy;

        // é€²çƒåˆ¤å®š (ç”±ä¸Šè€Œä¸‹ç©¿éç±ƒæ¡†)
        if (ball.vy > 0 && 
            ball.x > hoop.x && ball.x < hoop.x + hoop.width &&
            Math.abs(ball.y - hoop.y) < 20) {
            
            score += 10;
            popText(canvas.width/2, hoop.y - 40, "+10 é€²çƒï¼", "#FFB74D");
            document.getElementById('score-text').innerText = score;
            resetBall();
            if (score >= 100) victory();
        }

        // æ‰å‡ºè¢å¹•é‡ç½®
        if (ball.y > canvas.height + 50 || ball.x < -50 || ball.x > canvas.width + 50) {
            resetBall();
        }
    }

    floatingTexts.forEach(function(ft) { ft.y -= 1; ft.life -= 0.02; });
    floatingTexts = floatingTexts.filter(function(ft) { return ft.life > 0; });
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 1. èƒŒæ™¯
    ctx.fillStyle = "#E0F2F1";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // 2. ç•«ç±ƒæ¡† (ç›´å±ç½®ä¸­)
    ctx.strokeStyle = "#FF7043";
    ctx.lineWidth = 8;
    ctx.lineCap = "round";
    ctx.beginPath();
    ctx.moveTo(hoop.x, hoop.y);
    ctx.lineTo(hoop.x + hoop.width, hoop.y);
    ctx.stroke();

    // 3. ç•«è¼”åŠ©è·¯å¾‘ (æ‹–å‹•æ™‚)
    if (isDragging) {
        ctx.setLineDash([5, 8]);
        ctx.strokeStyle = "rgba(84, 110, 122, 0.4)";
        ctx.beginPath();
        ctx.moveTo(ball.x, ball.y);
        var dx = dragStart.x - dragCurrent.x;
        var dy = dragStart.y - dragCurrent.y;
        // ç•«å‡ºé æœŸè»Œè·¡
        ctx.lineTo(ball.x + dx * 1.5, ball.y + dy * 1.5);
        ctx.stroke();
        ctx.setLineDash([]);
    }

    // 4. ç•«çƒ (è«è˜­è¿ªç²‰)
    ctx.fillStyle = "#FFAB91";
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
    ctx.fill();
    ctx.strokeStyle = "#E64A19";
    ctx.lineWidth = 2;
    ctx.stroke();

    // 5. ç•«ç‰¹æ•ˆæ–‡å­—
    floatingTexts.forEach(function(ft) {
        ctx.globalAlpha = ft.life;
        ctx.fillStyle = ft.color;
        ctx.font = "bold 24px Arial";
        ctx.textAlign = "center";
        ctx.fillText(ft.text, ft.x, ft.y);
    });
    ctx.globalAlpha = 1.0;

    if (isGaming) requestAnimationFrame(draw);
}

function popText(x, y, txt, col) {
    floatingTexts.push({ x: x, y: y, text: txt + " (ç¸½åˆ†: "+score+")", color: col, life: 1 });
}

// --- ä¿®æ­£ï¼šæ›´ç©©å®šçš„æ‹–æ‹½ç›£è½å™¨ ---
function onPointerDown(e) {
    if (!isGaming || ball.isFlying) return;
    // æª¢æŸ¥æ˜¯å¦é»åœ¨çƒé™„è¿‘
    var dist = Math.hypot(e.clientX - ball.x, e.clientY - ball.y);
    if (dist < 60) {
        isDragging = true;
        dragStart = { x: e.clientX, y: e.clientY };
        dragCurrent = { x: e.clientX, y: e.clientY };
    }
}

function onPointerMove(e) {
    if (!isDragging) return;
    dragCurrent = { x: e.clientX, y: e.clientY };
}

function onPointerUp(e) {
    if (!isDragging) return;
    isDragging = false;
    
    var dx = dragStart.x - dragCurrent.x;
    var dy = dragStart.y - dragCurrent.y;
    
    // åªæœ‰ç•¶æ‹‰å‹•è·é›¢è¶³å¤ æ™‚æ‰ç™¼å°„
    if (Math.hypot(dx, dy) > 20) {
        ball.vx = dx * 0.12;
        ball.vy = dy * 0.12;
        ball.isFlying = true;
    }
}

function startGame() {
    document.getElementById('start-mask').style.display = 'none';
    isGaming = true;
    score = 0;
    document.getElementById('score-text').innerText = score;
    init();
    draw();
}

function victory() {
    isGaming = false;
    document.getElementById('final-score').innerText = "æ‹¿åˆ° 100 åˆ†é€šé—œäº†ï¼";
    document.getElementById('result-modal').style.display = 'flex';
}

// ç›£è½å™¨ç¶å®šåˆ° window ä»¥ç¢ºä¿ PC ç«¯ä¸æœƒå› ç‚ºæ»‘å‡ºç•«å¸ƒè€Œå¤±æ•ˆ
window.addEventListener('pointerdown', onPointerDown);
window.addEventListener('pointermove', onPointerMove);
window.addEventListener('pointerup', onPointerUp);
document.getElementById('start-btn').addEventListener('click', startGame);

window.addEventListener('resize', init);
window.addEventListener('touchmove', function(e){ if(isDragging) e.preventDefault(); }, {passive:false});

init();
</script>
</body>
</html>