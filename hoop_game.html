<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å°ä¼éµæŠ•ç±ƒå¤§è³½</title>
    <style>
        :root { --bg: #F5F5F5; --text: #546E7A; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; overflow: hidden; background: var(--bg); font-family: sans-serif; width: 100%; height: 100%; position: fixed; }
        #game-wrapper { position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; overflow: hidden; }
        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; touch-action: none; }

        .home-btn {
            position: absolute; top: 15px; right: 15px; width: 44px; height: 44px;
            background: rgba(255, 255, 255, 0.4); border: 2px solid #fff; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            color: var(--text); font-size: 24px; text-decoration: none;
            z-index: 10000; backdrop-filter: blur(5px);
        }

        #hud { position: absolute; top: 20px; left: 20px; color: var(--text); z-index: 5000; pointer-events: none; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.9); display: flex; justify-content: center; align-items: center; z-index: 8000; flex-direction: column; }
        .btn-real { background: #81C784; color: white; border: 3px solid white; padding: 18px 50px; font-size: 24px; border-radius: 60px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 0 #66BB6A; outline: none; }
    </style>
</head>
<body>

<div id="game-wrapper">
    <a href="index.html" class="home-btn">ğŸ </a>
    <div id="hud">
        <div style="font-size: 20px; font-weight: bold;">å¾—åˆ†: <span id="score-text">0</span> / 100</div>
    </div>
    
    <canvas id="gameCanvas"></canvas>

    <div id="start-mask" class="overlay">
        <h1 style="color:var(--text); margin-bottom:10px;">ğŸ€ æŠ•ç±ƒå¤§å¸«ç‰ˆ</h1>
        <p style="color:#78909C; margin-bottom:30px; text-align:center;">
            é€£çºŒæŠ•ç±ƒæŒ‘æˆ°ï¼<br>
            çƒæœƒè‡ªå‹•å‡ºç¾ï¼Œå°æº–ç§»å‹•çš„ç±ƒæ¡†ï¼
        </p>
        <button class="btn-real" id="start-btn">é–‹å§‹æ¯”è³½</button>
    </div>

    <div id="result-modal" class="overlay" style="display:none;">
        <div style="background: white; padding: 30px; border-radius: 25px; text-align: center; width: 85%; max-width: 320px;">
            <h2 style="color:var(--text);">æ­å–œé€šé—œï¼</h2>
            <p id="final-score" style="color:#FF8A80; font-size:28px; font-weight:bold; margin:15px 0;"></p>
            <button class="btn-real" style="font-size:18px; padding:12px 30px;" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
            <a href="index.html" style="text-decoration:none; color:#90A4AE; font-weight:bold; display:block; margin-top:20px;">å›åˆ°å¤§å»³</a>
        </div>
    </div>
</div>

<script>
var canvas = document.getElementById('gameCanvas');
var ctx = canvas.getContext('2d');
var score = 0;
var isGaming = false;

// ç‰©ç†èˆ‡ç‰©é«”
var gravity = 0.28;
var restitution = 0.65;
var balls = []; 
var hoop = { x: 0, y: 0, w: 90, h: 10, dir: 1, speed: 1.8 };

// åŸºç¤ä½ç½®
var startPos = { x: 0, y: 0 };
var dragCurrent = { x: 0, y: 0 };
var isDragging = false;
var floatingTexts = [];

function init() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    startPos.x = canvas.width / 2;
    startPos.y = canvas.height * 0.85;
    
    hoop.y = canvas.height * 0.25;
    hoop.x = canvas.width / 2 - hoop.w / 2;
}

// --- æ–°å¢ï¼šç¾åŒ–èƒŒæ™¯ç¹ªè£½å‡½æ•¸ ---
function drawSmarterBackground() {
    // 1. å¤©ç©ºæ¼¸å±¤ (ä½”ä¸Šé¢ 80%)
    var skyGrad = ctx.createLinearGradient(0, 0, 0, canvas.height * 0.8);
    skyGrad.addColorStop(0, "#D7E8F0"); // æŸ”å’Œè—ç°
    skyGrad.addColorStop(1, "#F0F4F8"); // è¿‘ä¹ç™½
    ctx.fillStyle = skyGrad;
    ctx.fillRect(0, 0, canvas.width, canvas.height * 0.8);

    // 2. åœ°é¢ (ä½”ä¸‹é¢ 20%)
    ctx.fillStyle = "#CFD8DC"; // è«è˜­è¿ªç°åœ°æ¿
    ctx.fillRect(0, canvas.height * 0.8, canvas.width, canvas.height * 0.2);

    // 3. åœ°å¹³ç·šæ¢
    ctx.beginPath();
    ctx.moveTo(0, canvas.height * 0.8);
    ctx.lineTo(canvas.width, canvas.height * 0.8);
    ctx.strokeStyle = "rgba(255,255,255,0.6)";
    ctx.lineWidth = 2;
    ctx.stroke();
}

function update() {
    if (!isGaming) return;

    // ç±ƒæ¡†ç§»å‹•
    hoop.x += hoop.dir * hoop.speed;
    if (hoop.x < 30 || hoop.x + hoop.w > canvas.width - 30) {
        hoop.dir *= -1;
    }

    // æ›´æ–°é£›è¡Œä¸­çš„çƒ
    for (var i = balls.length - 1; i >= 0; i--) {
        var b = balls[i];
        b.vy += gravity;
        b.x += b.vx;
        b.y += b.vy;

        // å¤©èŠ±æ¿ç¢°æ’åå½ˆ
        if (b.y - 22 < 0) {
            b.y = 22;
            b.vy = Math.abs(b.vy) * restitution;
        }

        // ç‰†å£ç¢°æ’
        if (b.x - 22 < 0 || b.x + 22 > canvas.width) {
            b.vx = -b.vx * restitution;
            b.x = b.x < 22 ? 22 : canvas.width - 22;
        }

        // é€²çƒåˆ¤å®š
        if (b.vy > 0 && b.x > hoop.x && b.x < hoop.x + hoop.w && Math.abs(b.y - hoop.y) < 15) {
            score += 10;
            popText(hoop.x + hoop.w/2, hoop.y - 40, "+10 é€²çƒå•¦ï¼", "#FFB74D");
            document.getElementById('score-text').innerText = score;
            balls.splice(i, 1);
            if (score >= 100) victory();
            continue;
        }

        // ç§»é™¤å‡ºç•Œçƒ
        if (b.y > canvas.height + 100) {
            balls.splice(i, 1);
        }
    }

    floatingTexts.forEach(function(ft) { ft.y -= 1; ft.life -= 0.02; });
    floatingTexts = floatingTexts.filter(function(ft) { return ft.life > 0; });
}

function drawHoop() {
    // ç±ƒæ¿
    ctx.strokeStyle = "#546E7A"; ctx.lineWidth = 4;
    ctx.strokeRect(hoop.x - 10, hoop.y - 60, hoop.w + 20, 60);
    ctx.fillStyle = "rgba(255,255,255,0.4)";
    ctx.fillRect(hoop.x - 10, hoop.y - 60, hoop.w + 20, 60);

    // ç±ƒç¶²
    ctx.strokeStyle = "rgba(255,255,255,0.7)"; ctx.lineWidth = 2;
    ctx.setLineDash([2, 4]);
    ctx.beginPath();
    for(var j=0; j<=hoop.w; j+=20) {
        ctx.moveTo(hoop.x + j, hoop.y);
        ctx.lineTo(hoop.x + j + (j < hoop.w/2 ? 10 : -10), hoop.y + 35);
    }
    ctx.stroke();
    ctx.setLineDash([]);

    // ç±ƒåœˆ
    ctx.strokeStyle = "#E53935"; ctx.lineWidth = 6; ctx.lineCap = "round";
    ctx.beginPath();
    ctx.moveTo(hoop.x, hoop.y);
    ctx.lineTo(hoop.x + hoop.w, hoop.y);
    ctx.stroke();
}

function drawBall(x, y, radius, isShadow) {
    ctx.globalAlpha = isShadow ? 0.3 : 1.0;
    ctx.fillStyle = "#FFAB91";
    ctx.beginPath(); ctx.arc(x, y, radius, 0, 7); ctx.fill();
    ctx.strokeStyle = "#E64A19"; ctx.lineWidth = 2; ctx.stroke();
}

function draw() {
    ctx.globalAlpha = 1.0;
    // ctx.clearRect(0, 0, canvas.width, canvas.height); // ä¸éœ€è¦äº†ï¼Œå› ç‚ºèƒŒæ™¯æœƒè¦†è“‹

    // --- ä½¿ç”¨æ–°çš„ç¾åŒ–èƒŒæ™¯ ---
    drawSmarterBackground();

    drawHoop();

    // å¾…å‘½çƒèˆ‡è¼”åŠ©ç·š
    if (!isDragging) {
        drawBall(startPos.x, startPos.y, 22, false);
    } else {
        ctx.setLineDash([5, 8]);
        ctx.strokeStyle = "rgba(84, 110, 122, 0.4)";
        ctx.beginPath();
        ctx.moveTo(startPos.x, startPos.y);
        var dx = startPos.x - dragCurrent.x;
        var dy = startPos.y - dragCurrent.y;
        ctx.lineTo(startPos.x + dx * 1.5, startPos.y + dy * 1.5);
        ctx.stroke();
        ctx.setLineDash([]);
        drawBall(startPos.x, startPos.y, 22, false);
    }

    // é£›è¡Œçƒ
    balls.forEach(function(b) {
        drawBall(b.x, b.y, 22, false);
    });

    // ç‰¹æ•ˆæ–‡å­—
    floatingTexts.forEach(function(ft) {
        ctx.globalAlpha = ft.life; ctx.fillStyle = ft.color;
        ctx.font = "bold 24px Arial"; ctx.textAlign = "center";
        ctx.fillText(ft.text, ft.x, ft.y);
    });
    ctx.globalAlpha = 1.0;

    if (isGaming) {
        update();
        requestAnimationFrame(draw);
    }
}

function popText(x, y, txt, col) {
    floatingTexts.push({ x: x, y: y, text: txt, color: col, life: 1 });
}

function onPointerDown(e) {
    if (!isGaming) return;
    isDragging = true;
    dragCurrent = { x: e.clientX, y: e.clientY };
    e.target.setPointerCapture(e.pointerId);
}

function onPointerMove(e) {
    if (!isDragging) return;
    dragCurrent = { x: e.clientX, y: e.clientY };
}

function onPointerUp(e) {
    if (!isDragging) return;
    isDragging = false;
    
    var dx = startPos.x - dragCurrent.x;
    var dy = startPos.y - dragCurrent.y;
    
    if (Math.abs(dx) > 10 || Math.abs(dy) > 10) {
        balls.push({
            x: startPos.x,
            y: startPos.y,
            vx: dx * 0.13,
            vy: dy * 0.13
        });
    }
}

function startGame() {
    document.getElementById('start-mask').style.display = 'none';
    isGaming = true;
    score = 0;
    balls = [];
    document.getElementById('score-text').innerText = score;
    init();
    draw();
}

function victory() {
    isGaming = false;
    document.getElementById('final-score').innerText = "åˆä½œæ‹¿åˆ° 100 åˆ†äº†ï¼";
    document.getElementById('result-modal').style.display = 'flex';
    try { localStorage.setItem('hoop_score', 100); } catch(e){}
}

canvas.addEventListener('pointerdown', onPointerDown);
canvas.addEventListener('pointermove', onPointerMove);
canvas.addEventListener('pointerup', onPointerUp);
canvas.addEventListener('pointercancel', onPointerUp);

document.getElementById('start-btn').addEventListener('click', startGame);
window.addEventListener('resize', init);
window.addEventListener('touchmove', function(e){ if(isDragging) e.preventDefault(); }, {passive:false});

init();
</script>
</body>
</html>